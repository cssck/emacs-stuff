#!/usr/bin/env bash

guix package -i stow
cd ./configs
for PACKAGE in *; do stow $PACKAGE -t $HOME; done
cd ..
guix pull # for new channels
sudo cp ./configs-root/etc/config.scm /etc/
sudo cp ./misc/signing-key.pub /etc/
sudo guix archive --authorize < ./misc/signing-key.pub
guix package -m ./misc/guix-manifest
echo "\nAdd UUIDs in /etc/config.scm !!!\n"
echo "Then run:\n \
sudo guix system reconfigure /etc/config.scm --substitute-urls='https://ci.guix.gnu.org https://bordeaux.guix.gnu.org https://substitutes.nonguix.org'"
